"use strict";var app=angular.module("Rubrica",["btford.socket-io","timer"]);app.factory("$socket",["socketFactory",function(a){return a()}]),app.controller("RubricaController",["$scope","$http","$socket",function(a,b,c){var d=a;d.criterios=[],d.reports=[],d.iteration=-1,d.myUid=-1,d.sesStatusses=["Lectura","Individual","An\xF3nimo","Grupal","Reporte","Rubrica Calibraci\xF3n","Evaluaci\xF3n de Pares","Finalizada"],d.canAnswer=!0,d.init=function(){d.getReports(),d.getRubrica(),c.on("stateChange",function(f){console.log("SOCKET.IO",f),f.ses==d.sesId&&d.getReports()}),c.on("reportChange",function(f){console.log("SOCKET.IO",f),f.ses==d.sesId&&d.getReports()})},d.getReports=function(){b({url:"get-ses-info",method:"post"}).success(function(f){d.iteration=f.iteration,d.sesId=f.id,d.myUid=f.uid,d.sesSTime=null==f.stime?null:new Date(f.stime),5==d.iteration?b({url:"get-active-example-report",method:"post"}).success(function(g){d.reports=[g],d.fillSelections()}):6==d.iteration&&b({url:"get-paired-report",method:"post"}).success(function(g){d.reports=g,d.fillSelections()})})},d.getRubrica=function(){b({url:"get-rubrica",method:"post"}).success(function(f){d.criterios=f})},d.checkCriteria=function(f){return null!=f.id&&null!=f.select&&d.criterios.reduce(function(g,h){return null!=f.select[h.id]&&g},!0)},d.sendSelection=function(f){if(d.checkCriteria(f)){d.criterios.forEach(function(h){var j={cid:h.id,sel:f.select[h.id],rid:f.id};b({url:"send-criteria-selection",method:"post",data:j}).success(function(){console.log("ok")})});var g={rid:f.id,text:f.comment};if(b({url:"send-report-comment",method:"post",data:g}).success(function(){console.log("ok")}),f.status="SENT",5==d.iteration){d.canAnswer=!1;var h={rid:f.id};b({url:"get-criteria-answer",method:"post",data:h}).success(function(j){var k=d.reports.findIndex(function(l){return l.id==f.id});console.log(k),d.reports[k].truev={},j.forEach(function(l){d.reports[k].truev[l.cid]=l.selection})})}}},d.fillSelections=function(){d.reports.forEach(function(f){var g={rid:f.id};d.canAnswer=!0,b({url:"get-criteria-selection",method:"post",data:g}).success(function(h){f.select={},h.forEach(function(j){f.select[j.cid]=j.selection,d.canAnswer=!1})})})},d.init()}]);
