"use strict";var app=angular.module("Rubrica",["btford.socket-io","timer"]);app.factory("$socket",["socketFactory",function(a){return a()}]),app.controller("RubricaController",["$scope","$http","$socket",function(a,b,c){var d=a;d.criterios=[],d.reports=[],d.iteration=-1,d.myUid=-1,d.sesStatusses=["Lectura","Individual","An\xF3nimo","Grupal","Reporte","Rubrica Calibraci\xF3n","Evaluaci\xF3n de Pares","Finalizada"],d.init=function(){d.getReports(),d.getRubrica(),c.on("stateChange",function(e){console.log("SOCKET.IO",e),e.ses==d.sesId&&d.getReports()})},d.getReports=function(){b({url:"get-ses-info",method:"post"}).success(function(e){d.iteration=e.iteration,d.myUid=e.uid,d.sesSTime=null==e.stime?null:new Date(e.stime),5==d.iteration?b({url:"get-active-example-report",method:"post"}).success(function(f){d.reports=[f],d.fillSelections()}):6==d.iteration&&b({url:"get-paired-report",method:"post"}).success(function(f){d.reports=f,d.fillSelections()})})},d.getRubrica=function(){b({url:"get-rubrica",method:"post"}).success(function(e){d.criterios=e})},d.checkCriteria=function(e){return null!=e.select&&d.criterios.reduce(function(f,g){return null!=e.select[g.id]&&f},!0)},d.sendSelection=function(e){if(d.checkCriteria(e)){d.criterios.forEach(function(g){var h={cid:g.id,sel:e.select[g.id],rid:e.id};b({url:"send-criteria-selection",method:"post",data:h}).success(function(){console.log("ok")})});var f={rid:e.id,text:e.comment};b({url:"send-report-comment",method:"post",data:f}).success(function(){console.log("ok")})}},d.fillSelections=function(){d.reports.forEach(function(e){var f={rid:e.id};b({url:"get-criteria-selection",method:"post",data:f}).success(function(g){e.select={},g.forEach(function(h){e.select[h.cid]=h.selection})})})},d.init()}]);
