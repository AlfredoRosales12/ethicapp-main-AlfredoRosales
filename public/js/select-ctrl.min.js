"use strict";var app=angular.module("Select",[]);app.controller("SelectController",["$scope","$http",function(a,b){var c=a;c.selectedQs=0,c.iteration=1,c.myUid=-1,c.questions=[],c.otherAnswsers={},c.answers={},c.comments={},c.optLabels=["A","B","C","D","E"],c.sent={},c.teamUids=[],c.bottomMsg="",c.ansIter1={},c.ansIter2={},c.init=function(){c.loadQuestions(),c.getSesInfo()},c.getSesInfo=function(){b({url:"get-ses-info",method:"post"}).success(function(d){c.iteration=d.iteration,c.myUid=d.uid,c.sesName=d.name;var e=new Set;1<c.iteration&&b({url:"get-team-selection",method:"post",data:{iteration:1}}).success(function(f){f.forEach(function(g){c.ansIter1[g.qid]=c.ansIter1[g.qid]||{},c.ansIter1[g.qid][g.uid]={answer:g.answer,comment:g.comment},e.add(g.uid),c.teamUids=Array.from(e)})}),2<c.iteration&&b({url:"get-team-selection",method:"post",data:{iteration:2}}).success(function(f){f.forEach(function(g){c.ansIter2[g.qid]=c.ansIter2[g.qid]||{},c.ansIter2[g.qid][g.uid]={answer:g.answer,comment:g.comment},e.add(g.uid),c.teamUids=Array.from(e)})}),c.loadAnswers()})},c.loadQuestions=function(){b({url:"get-questions",method:"post"}).success(function(d){c.questions=d,c.questions.forEach(function(e){e.options=e.options.split("\n")})})},c.loadAnswers=function(){b({url:"get-answers",method:"post",data:{iteration:Math.min(3,c.iteration)}}).success(function(d){d.forEach(function(e){c.answers[e.qid]=e.answer,c.comments[e.qid]=e.comment,c.sent[e.qid]=!0})})},c.setAnswer=function(d,e){c.answers[d.id]=e,d.dirty=!0},c.selectQuestion=function(d){c.selectedQs=d},c.nextQuestion=function(){if(c.selectedQs>=c.questions.length-1)return void(c.bottomMsg="Se alcanzo el final de la actividad");if(3==c.iteration){console.log("Checking team answers");var d={qid:c.questions[c.selectedQs].id};b({url:"check-team-answer",method:"post",data:d}).success(function(e){"ok"==e.status?(c.selectQuestion(c.selectedQs+1),c.bottomMsg=""):"incomplete"==e.status?c.bottomMsg="Debe esperar a que todos los miembros del equipo respondan":"different"==e.status&&(c.bottomMsg="Las respuestas de los miembros del equipo no coinciden")})}else c.selectQuestion(c.selectedQs+1)},c.prevQuestion=function(){return 0>=c.selectedQs?void(c.bottomMsg="Se alcanzo el inicio de la actividad"):void(3!=c.iteration&&c.selectQuestion(c.selectedQs-1))},c.sendAnswer=function(d){var e={qid:d.id,answer:c.answers[d.id],comment:c.comments[d.id],iteration:c.iteration};b({url:"send-answer",method:"post",data:e}).success(function(f){"ok"==f.status&&(c.sent[e.qid]=!0,d.dirty=!1)})},c.init()}]);
