"use strict";window.StagesController=function(b,h,f){var d=b;d.stages=[],console.log(d.flang);var c=function(a,b){return{key:a+(null==b?"":" "+b),name:d.flang(a)+(null==b?"":" "+d.flang(b))}};d.methods=[c("random"),c("performance","homog"),c("performance","heterg"),c("knowledgeType","homog"),c("knowledgeType","heterg")],d.readonly=!1,d.stage={type:null,anon:!1,chat:!1,prevResponses:[]},d.stageRoles=[],d.roles=[],d.currentStage=-1,d.setCurrentStage=function(c){if(-1!=c){d.readonly=!0;var b={stageid:d.stages[c].id};h({url:"get-actors",method:"post",data:b}).success(function(a){d.roles=a}),d.stage=d.stages[c]}else d.readonly=!1,d.stage={type:null,anon:!1,chat:!1,prevResponses:[]};d.currentStage=c},d.getStages=function(){var a={sesid:d.selectedSes.id};h({url:"get-admin-stages",method:"post",data:a}).success(function(c){d.stages=c;var b={stageid:d.selectedSes.current_stage};h({url:"get-actors",method:"post",data:b}).success(function(a){d.roles=a})})},d.changeStage=function(a){d.currentStage=a},d.addRole=function(){d.roles.push({name:"",type:"order"})},d.setAllRolesType=function(b){for(var c=0;c<d.roles.length;c++)d.roles[c].type=b},d.removeRole=function(a){d.roles.splice(a,1)},d.sendStage=function(){var b=d.stage;if(null==b.type||0==d.roles.length)return void f.error("Hay datos faltantes");var c={number:d.stages.length+1,type:b.type,anon:b.anon,chat:b.chat,sesid:d.selectedSes.id,prev_ans:b.prevResponses.join(",")};h({url:"add-stage",method:"post",data:c}).success(function(a){var g=a.id;null==g?f.error("Error al crear la etapa"):function(){for(var e=d.roles.length,a=0;a<d.roles.length;a++){var i=d.roles[a],j={name:i.name,jorder:"order"==i.type,stageid:g};h({url:"add-actor",method:"post",data:j}).success(function(){if(console.log("Actor added"),e-=1,0==e){var b={sesid:d.selectedSes.id,stageid:g};h({url:"session-start-stage",method:"post",data:b}).success(function(){f.success("Etapa creada correctamente"),d.getStages()})}})}}()})},d.getStages()};
