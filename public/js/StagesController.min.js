"use strict";window.StagesController=function(a,k,g){var e=a;e.stages=[],console.log(e.flang);var b=function(c,a){return{key:c+(null==a?"":" "+a),name:e.flang(c)+(null==a?"":" "+e.flang(a))}};e.methods=[b("random"),b("performance","homog"),b("performance","heterg"),b("knowledgeType","homog"),b("knowledgeType","heterg")],e.stage={type:null,anon:!1,chat:!1,prevResponses:[]},e.stageRoles=[],e.roles=[],e.currentStage=-1,e.setCurrentStage=function(a){e.currentStage=a},e.getStages=function(){var a={sesid:e.selectedSes.id};k({url:"get-admin-stages",method:"post",data:a}).success(function(a){e.stages=a})},e.changeStage=function(a){e.currentStage=a},e.addRole=function(){e.roles.push({name:"",type:"order"})},e.setAllRolesType=function(a){for(var b=0;b<e.roles.length;b++)e.roles[b].type=a},e.removeRole=function(a){e.roles.splice(a,1)},e.sendStage=function(){var a=e.stage;if(null==a.type||0==e.roles.length)return void g.error("Hay datos faltantes");var b={number:e.stages.length+1,type:a.type,anon:a.anon,chat:a.chat,sesid:e.selectedSes.id,prev_ans:a.prevResponses.join(",")};k({url:"add-stage",method:"post",data:b}).success(function(a){var c=a.id;null==c?g.error("Error al crear la etapa"):function(){for(var d=e.roles.length,a=0;a<e.roles.length;a++){var f=e.roles[a],h={name:f.name,jorder:"order"==f.type,stageid:c};k({url:"add-actor",method:"post",data:h}).success(function(){if(console.log("Actor added"),d-=1,0==d){var b={sesid:e.selectedSes.id,stageid:c};k({url:"session-start-stage",method:"post",data:b}).success(function(){g.success("Etapa creada correctamente"),e.getStages()})}})}}()})},e.getStages()};
