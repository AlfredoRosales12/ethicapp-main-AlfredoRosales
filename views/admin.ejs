<!DOCTYPE html>
<html ng-app="Admin">
<head>
    <meta charset="UTF-8">
    <title>DocCollab</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="stylesheet" href="css/bootstrap.min.css"/>
    <link rel="stylesheet" href="css/font-awesome.min.css"/>
    <link rel="stylesheet" href="css/nv.d3.min.css">
    <link rel="stylesheet" href="css/angular-ui-notification.min.css">
    <link rel="stylesheet" href="//cdn.quilljs.com/1.2.0/quill.snow.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.css">
    <link rel="stylesheet" href="css/main.css"/>
    <script src="libs/angular.min.js"></script>
    <script src="libs/ui-bootstrap-tpls-1.1.2.min.js"></script>
    <script src="libs/katex.min.js"></script>
    <script src="libs/angular-bootstrap-multiselect.js"></script>
    <script src="libs/d3.min.js"></script>
    <script src="libs/nv.d3.min.js"></script>
    <script src="libs/angular-nvd3.min.js"></script>
    <script src="libs/ng-map.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&key=AIzaSyAx05l8YIv_oB8f5AMBGIcWmgnqFou0VJI&libraries=drawing,geometry,places"></script>
    <script type="text/javascript" src="libs/quill.min.js"></script>
    <script type="text/javascript" src="libs/ng-quill.min.js"></script>
    <script src="libs/angular-timer.min.js"></script>
    <script src="libs/angular-ui-notification.min.js"></script>
    <script src="js/admin-ctrl.js"></script>
</head>
<body class="bg-white" ng-controller="AdminController">

<div ng-controller="TabsController">

    <div class="top-bar">

        <div class="chip" ng-show="selectedId == -1">
            <i class="fa fa-list"></i> {{'selectSes' | lang}}
        </div>

        <div class="chip hoverable" ng-show="selectedId != -1" ng-click="backToList()">
            <i class="fa fa-caret-left"></i> {{selectedSes.name}}
        </div>

        <div class="chip hoverable" ng-repeat="tab in tabOptions" ng-class="{active: tab == selectedTab}" ng-click="setTab(tab)">
            <i class="fa fa-{{secIcons[tab]}}"></i> {{tab | lang}}
        </div>

        <a class="chip hoverable pull-right" href="logout">
            {{'logout' | lang}}
        </a>

        <span class="chip hoverable pull-right" ng-click="changeLang()">
            {{'langOther' | lang}}
        </span>

        <div class="top-bar-second" ng-show="selectedId != -1">
            <span ng-repeat="st in sesStatusses">
                <span ng-if="selectedSes.type != 'M'" class="label label-default bg-black-alpha" ng-class="{'bg-yellow': $index==selectedSes.status-1}">
                    {{st | lang}}
                </span>
                <span ng-if="selectedSes.type == 'M'" class="label label-default bg-black-alpha" ng-class="{'bg-yellow': st.i == selectedSes.status-2}">
                    {{st.name | lang}}
                </span>
                <span ng-hide="$last">→</span>
            </span>
            <span class="simple-margin-left" ng-show="selectedSes != null && selectedSes.stime != null">
                <timer start-time="selectedSes.stime">{{hours}}h {{minutes}}m {{seconds}}s</timer>
            </span>
            <button class="btn btn-xs btn-default simple-margin-left" ng-click="shared.changeState()">{{'gotoNext' | lang}}</button>
        </div>

        <!--<div class="col-sm-1">
            <button class="btn btn-default" ng-click="toggleSidebar()">
                <i class="fa fa-bars"></i>
            </button>
        </div>
        <div class="col-sm-10">
            <h5>{{'adminPanel' | lang}}</h5>
        </div>
        <div class="col-sm-1">
            <a class="btn btn-default pull-right margin-right-24" href="logout"><i class="fa fa-close"></i></a>
        </div>-->
    </div>

    <div class="container-fluid full-height-topbar admin-container">

        <div ng-show="selectedId == -1">
            <button class="btn btn-sm btn-primary pull-right" ng-click="openNewSes()">{{'new' | lang}}</button>
            <h4>{{'sessionList' | lang}}:</h4>
            <input placeholder="Buscar..." class="form-control" ng-model="sesSearch">
            <div class="list-group">
                <a class="list-group-item" ng-repeat="ses in sessions | filter:sesSearch" ng-click="selectSession(ses,ses.id)"
                   ng-class="{'active':ses.id==selectedId}">
                    <button class="btn btn-default pull-right" ng-click="openDuplicateSesSpec(ses,$event)" ng-disabled="ses.type != 'S' && ses.type != 'M'">
                        <i class="fa fa-copy"></i>
                    </button>
                    <h4 class="list-group-item-heading">{{ses.name}}
                        <span class="text-gray font-mini"> - {{typeNames[ses.type] | lang}} - {{ses.time | date}}</span>
                    </h4>
                    <p class="list-group-item-text" ng-bind="ses.descr"></p>
                </a>
            </div>
        </div>

        <!-- SES INFO -->
        <!--<div ng-show="selectedTab == 'configuration'" ng-controller="SesEditorController">
            <h3>{{selectedSes.name}}</h3>
            <h4>{{'workflow' | lang}}:</h4>
            <div class="center-block font-large">
                <button class="btn btn-sm btn-default pull-right" ng-click="shared.changeState()">{{'gotoNext' | lang}}</button>
                <span ng-repeat="st in sesStatusses">
                    <span ng-if="selectedSes.type != 'M'" class="label label-default" ng-class="{'label-info': $index==selectedSes.status-1}">
                        {{st | lang}}
                    </span>
                    <span ng-if="selectedSes.type == 'M'" class="label label-default" ng-class="{'label-info': st.i == selectedSes.status-2}">
                        {{st.name | lang}}
                    </span>
                    <span ng-hide="$last">→</span>
                </span>
            </div>
            <br>
            <div ng-show="selectedSes.stime != null">
                <strong>{{'timer' | lang}}</strong>:
                <timer start-time="selectedSes.stime">{{hours}}h {{minutes}}m {{seconds}}s</timer>
            </div>
            <br>
            <hr>
            <br>
            <label>{{'title' | lang}}:</label>
            <input type="text" class="form-control" ng-model="selectedSes.name" ng-disabled="selectedSes.status!=1">
            <br>
            <button class="btn btn-default btn-sm pull-right" ng-class="{'active': splitDescr}" ng-click="toggleSplit()" ng-show="selectedSes.type == 'M'" ng-disabled="selectedSes.status!=1">Dividir Factor Detonante</button>
            <label ng-if="selectedSes.type != 'S'">{{'detFactor' | lang}}:</label>
            <label ng-if="selectedSes.type == 'S'">{{'generalInst' | lang}}:</label>
            <textarea class="form-control" ng-model="selectedSes.descr" ng-disabled="selectedSes.status!=1" ng-show="!splitDescr"></textarea>
            <div ng-show="splitDescr">
                <input type="text" class="form-control" ng-disabled="selectedSes.status!=1" ng-model="splDes1" placeholder="Selección de unidades">
                <input type="text" class="form-control" ng-disabled="selectedSes.status!=1" ng-model="splDes2" placeholder="Reporte">
            </div>
            <!-- <button class="btn btn-xs btn-default" ng-click="openDuplicateSes()" ng-disabled="selectedSes.type != 'S' && selectedSes.type != 'M'">{{'duplicateSes' | lang}}</button> --
            <a class="btn btn-xs btn-default" href="export-session-data-sel?id={{selectedSes.id}}" ng-if="selectedSes.type == 'S' && selectedSes.status == 5">{{'exportSesData' | lang}}</a>
            <br>
            <button class="btn btn-default pull-right" ng-click="updateSession()" ng-disabled="selectedSes.status!=1">
                {{'saveChanges' | lang}}
            </button>
            <br>
            <br>
            <hr>
            <hr>
            <br>
            <!-- OPTIONS --
            <div ng-controller="OptionsController" ng-show="selectedSes.type == 'S'">
                <h4>{{'optionsConfig' | lang}}</h4>
                <div class="row sliders" ng-class="{'bg-gray': selectedSes.status!=1}">
                    <div ng-repeat="opt in options">
                        <div class="col-sm-6 col-sm-offset-2"><span class="slider-label">{{opt.name | lang}}</span></div>
                        <div class="col-sm-4">
                            <div class="onoffswitch">
                                <input type="checkbox" id="sl{{$index}}" class="onoffswitch-checkbox" ng-model="conf[opt.code]" ng-disabled="selectedSes.status!=1">
                                <label class="onoffswitch-label" for="sl{{$index}}">
                                    <span class="onoffswitch-inner"></span>
                                    <span class="onoffswitch-switch"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <br>
                <br>
                <button class="btn btn-default pull-right" ng-click="saveConfs()" ng-disabled="selectedSes.status!=1">{{'saveChanges' | lang}}</button>
            </div>
        </div>-->

        <!-- CONFIGURACION -->
        <div class="pad-content" ng-show="selectedTab == 'editor'">
            <div ng-controller="SesEditorController" class="simple-padding-top">
                <label>{{'title' | lang}}:</label>
                <input type="text" class="form-control" ng-model="selectedSes.name" ng-disabled="selectedSes.status!=1">
                <br>
                <button class="btn btn-default btn-sm pull-right" ng-class="{'active': splitDescr}" ng-click="toggleSplit()" ng-show="selectedSes.type == 'M'" ng-disabled="selectedSes.status!=1">Dividir Factor Detonante</button>
                <label ng-if="selectedSes.type != 'S'">{{'detFactor' | lang}}:</label>
                <label ng-if="selectedSes.type == 'S'">{{'generalInst' | lang}}:</label>
                <textarea class="form-control" ng-model="selectedSes.descr" ng-disabled="selectedSes.status!=1" ng-show="!splitDescr"></textarea>
                <div ng-show="splitDescr">
                    <input type="text" class="form-control" ng-disabled="selectedSes.status!=1" ng-model="splDes1" placeholder="Selección de unidades">
                    <input type="text" class="form-control" ng-disabled="selectedSes.status!=1" ng-model="splDes2" placeholder="Reporte">
                </div>
                <!-- <button class="btn btn-xs btn-default" ng-click="openDuplicateSes()" ng-disabled="selectedSes.type != 'S' && selectedSes.type != 'M'">{{'duplicateSes' | lang}}</button> -->
                <a class="btn btn-xs btn-default" href="export-session-data-sel?id={{selectedSes.id}}" ng-if="selectedSes.type == 'S' && selectedSes.status == 5">{{'exportSesData' | lang}}</a>
                <br>
                <button class="btn btn-default pull-right" ng-click="updateSession()" ng-disabled="selectedSes.status!=1">
                    {{'saveChanges' | lang}}
                </button>
                <br>
                <br>
                <hr>
                <hr>
                <br>
                <!-- OPTIONS -->
                <div ng-controller="OptionsController" ng-show="selectedSes.type == 'S'">
                    <h4>{{'optionsConfig' | lang}}</h4>
                    <div class="row sliders" ng-class="{'bg-gray': selectedSes.status!=1}">
                        <div ng-repeat="opt in options">
                            <div class="col-sm-6 col-sm-offset-2"><span class="slider-label">{{opt.name | lang}}</span></div>
                            <div class="col-sm-4">
                                <div class="onoffswitch">
                                    <input type="checkbox" id="sl{{$index}}" class="onoffswitch-checkbox" ng-model="selectedSes.conf[opt.code]" ng-disabled="selectedSes.status!=1">
                                    <label class="onoffswitch-label" for="sl{{$index}}">
                                        <span class="onoffswitch-inner"></span>
                                        <span class="onoffswitch-switch"></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <br>
                    <br>
                    <button class="btn btn-default pull-right" ng-click="saveConfs()" ng-disabled="selectedSes.status!=1">{{'saveChanges' | lang}}</button>
                    <br>
                    <hr>
                    <hr>
                </div>
            </div>
            <!--<div ng-show="selectedTabConfig == -1">-->
            <div ng-show="selectedSes.type == 'M'" ng-controller="SemDocController">
                <h4>{{'documents' | lang}}</h4>
                <div class="list-group-item" ng-repeat="doc in semDocs">
                    <strong ng-bind="doc.title"></strong>
                    <button class="btn btn-xs btn-default pull-right" ng-disabled="selectedSes.status!=1" ng-click="deleteText(doc.id)">{{'delete' | lang}}</button>
                    <button class="btn btn-xs btn-default pull-right margin-right-8" ng-disabled="selectedSes.status!=1" ng-click="startEditText(doc)">{{'edit' | lang}}</button>
                    <button class="btn btn-xs btn-default pull-right margin-right-8" ng-click="doc.expanded = !doc.expanded">{{'view' | lang}}</button>
                    <p ng-show="!doc.expanded">{{doc.content | limitTo:360}}</p>
                    <p ng-show="doc.expanded">{{doc.content}}</p>
                </div>
                <div>
                    <label ng-show="newSDoc.id == null">{{'add' | lang}} {{'document' | lang}}</label>
                    <label ng-show="newSDoc.id != null">{{'edit' | lang}} {{'document' | lang}}</label>
                    <input type="text" ng-model="newSDoc.title" placeholder="Titulo" class="form-control" ng-disabled="selectedSes.status!=1">
                    <textarea class="form-control" rows="5" ng-model="newSDoc.content" ng-disabled="selectedSes.status!=1"></textarea>
                    <button class="btn btn-default pull-right" ng-show="newSDoc.id == null" ng-click="addSemDoc()" ng-disabled="selectedSes.status!=1">{{'add' | lang}}</button>
                    <button class="btn btn-default pull-right" ng-show="newSDoc.id != null" ng-click="updateSemDoc()" ng-disabled="selectedSes.status!=1">{{'update' | lang}}</button>
                    <br>
                    <br>
                </div>
            </div>
            <div ng-show="selectedSes.type == 'L'" ng-controller="DocumentsController">
                <h4>{{'documents' | lang}}</h4>
                <div class="list-group">
                    <div class="list-group-item" ng-repeat="doc in documents">
                        <i class="fa fa-file-text-o"></i> <strong ng-bind="doc.title"></strong>
                        <a href="{{doc.path}}" class="discrete"> - {{'viewOriginalDoc'}}</a>
                        <button class="btn btn-xs btn-default pull-right" ng-disabled="selectedSes.status!=1" ng-click="deleteDocument(doc.id)">{{'delete' | lang}}</button>
                    </div>
                </div>
                <br>
                <label>{{'add' | lang}} {{'document' | lang}}:</label>
                <form id="doc-form" class="row" ng-submit="uploadDocument($event)" enctype="multipart/form-data">
                    <div class="col-sm-4">
                        <input type="text" class="form-control" name="title" placeholder="Titulo" required ng-disabled="selectedSes.status!=1" maxlength="20">
                    </div>
                    <div class="col-sm-7">
                        <input type="file" class="form-control" name="pdf" ng-disabled="selectedSes.status!=1" required>
                        <input type="text" ng-value="selectedSes.id" name="sesid" hidden>
                    </div>
                    <div class="col-sm-1">
                        <button class="form-control btn btn-default" ng-disabled="selectedSes.status!=1 || busy">{{'upload' | lang}} <i ng-show="busy" class="fa fa-spinner fa-pulse"></i></button>
                    </div>
                </span>
                </form>
                <br>
                <hr>
                <a href="to-pauta?sesid={{selectedSes.id}}" class="btn btn-primary btn" ng-show="selectedSes.type=='L'">
                    {{'keywordPauta' | lang}}
                </a>
            </div>
                <a href="to-semantic?sesid={{selectedSes.id}}" class="btn btn-primary btn" ng-show="selectedSes.type=='M'">
                    {{'semanticUnitPauta' | lang}}
                </a>
            <div ng-show="selectedSes.type == 'S'" ng-controller="QuestionsController">
                <h4>{{'texts' | lang}}</h4>
                <div class="list-group-item" ng-repeat="text in questionTexts">
                    <strong ng-bind="text.title"></strong>
                    <button class="btn btn-xs btn-default pull-right" ng-disabled="selectedSes.status!=1" ng-click="deleteQuestionText(text.id)">{{'delete' | lang}}</button>
                    <button class="btn btn-xs btn-default pull-right margin-right-8" ng-disabled="selectedSes.status!=1" ng-click="startEditText(text)">{{'edit' | lang}}</button>
                    <button class="btn btn-xs btn-default pull-right margin-right-8" ng-click="text.expanded = !text.expanded">{{'view' | lang}}</button>
                    <p ng-show="!text.expanded">{{text.content | htmlExtractText | limitTo:360}}</p>
                    <div ng-show="text.expanded" ng-bind-html="text.content | trustHtml"></div>
                </div>
                <div>
                    <label ng-show="newText.id == null">{{'add' | lang}} {{'text' | lang}}</label>
                    <label ng-show="newText.id != null">{{'edit' | lang}} {{'text' | lang}}</label>
                    <input type="text" ng-model="newText.title" placeholder="Titulo" class="form-control" ng-disabled="selectedSes.status!=1">
                    <ng-quill-editor ng-model="newText.content" class="large" ng-class="{'quill-disabled': selectedSes.status!=1}"></ng-quill-editor>
                    <button class="btn btn-default pull-right" ng-show="newText.id == null" ng-click="addQuestionText()" ng-disabled="selectedSes.status!=1">{{'add' | lang}}</button>
                    <button class="btn btn-default pull-right" ng-show="newText.id != null" ng-click="updateQuestionText()" ng-disabled="selectedSes.status!=1">{{'update' | lang}}</button>
                </div>

                <hr>
                <br>

                <h4>{{'questions' | lang}}</h4>
                <div class="list-group-item" ng-repeat="qs in questions">
                    <strong>{{$index+1}}. </strong>
                    <strong ng-show="!qs.expanded">{{ qs.content | htmlExtractText | limitTo:80}}</strong>
                    <!-- <strong ng-show="qs.expanded">{{($index+1) + ". " + qs.content | htmlExtractText}}</strong> -->
                    <button class="btn btn-xs btn-default pull-right" ng-disabled="selectedSes.status!=1" ng-click="deleteQuestion(qs.id)">{{'delete' | lang}}</button>
                    <button class="btn btn-xs btn-default pull-right margin-right-8" ng-disabled="selectedSes.status!=1" ng-click="startEditQuestion(qs)">{{'edit' | lang}}</button>
                    <button class="btn btn-xs btn-default pull-right margin-right-8" ng-click="expandQuestion(qs)">{{'view' | lang}}</button>
                    <div ng-show="qs.expanded">
                        <div ng-bind-html="qs.content | trustHtml"></div>
                        <div ng-repeat="x in qs.options" ng-class="{'bg-lightgreen': $index == qs.answer}">
                            {{qsLabels[$index]}}. {{x}}
                        </div>
                        <br>
                        <strong>{{'comment' | lang}}:</strong>
                        <p ng-bind="qs.comment"></p>
                        <strong>{{'others' | lang}}:</strong>
                        <span ng-bind="qs.other"></span>
                    </div>
                </div>
                <br>

                <div class="plugin-content" ng-show="newQuestion.includesMap || misc.mapHasVisData" ng-controller="GeoAdminController">
                    <strong ng-show="newQuestion.includesMap">{{'mapInstr' | lang}}</strong>
                    <div class="row-no-padding">
                        <div class="col-sm-2">
                            <div class="map-sidebar">
                                <h4>{{'elements' | lang}}</h4>
                                <div class="list-group">
                                    <a ng-repeat="overlay in mOverlays" class="list-group-item" ng-click="selectOverlay(overlay.id)">
                                        {{overlay.name}}
                                    </a>
                                    <a ng-repeat="overlay in sOverlays" class="list-group-item" ng-click="selectOverlay(overlay.id)">
                                        {{overlay.name}}
                                    </a>
                                    <span ng-show="mOverlays.length == 0 && sOverlays.length == 0">{{'mapWoElements' | lang}}</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-10">
                            <input class="gsearch" places-auto-complete on-place-changed="googleSearch()" ng-if="newQuestion.includesMap">
                            <ng-map class="map-block map-tbl" center="[-33.45, -70.65]" zoom="12" trigger-resize="true">

                                <!-- DRAW MANAGER -->
                                <drawing-manager
                                        ng-if="newQuestion.includesMap"
                                        on-overlaycomplete="onMapOverlayCompleted()"
                                        drawing-control-options="{position: 'TOP_CENTER'}"
                                        drawingControl="true"
                                        drawingMode="null"
                                        markerOptions="{draggable: true}"
                                        polylineOptions="{strokeColor:'darkred', editable: true, draggable: true}"
                                        rectangleOptions="{fillColor: 'red', strokeColor:'darkred', editable: true, draggable: true}"
                                        polygonOptions="{fillColor: 'red', strokeColor:'darkred', editable: true, draggable: true}"
                                        circleOptions="{fillColor: 'red', strokeColor:'darkred', editable: true, draggable: true}">
                                </drawing-manager>

                                <!-- NEW OVERLAYS -->
                                <marker ng-if="newOverlay.type == 'M' && newOverlay.geom.position != null" id="nmkr" draggable="true"
                                        position="{{newOverlay.geom.position}}" icon="img/marker-{{newOverlay.color}}.png"></marker>
                                <shape ng-if="newOverlay.type != 'M'" id="nshp" name="{{newOverlay.fullType}}" path="{{newOverlay.geom.path}}"
                                       bounds="{{newOverlay.geom.bounds}}" center="{{newOverlay.geom.center}}"
                                       radius="{{newOverlay.geom.radius}}"
                                       fill-color="{{newOverlay.color}}" stroke-color="dark{{newOverlay.color}}" editable="true"
                                       draggable="true"></shape>

                                <!-- SESSION OVERLAYS -->
                                <marker ng-repeat="overlay in mOverlays" id="{{overlay.id}}" position="{{overlay.geom.position}}"
                                        icon="img/marker-{{overlay.color}}.png" on-click="clickOverlay($event)"></marker>
                                <shape ng-repeat="overlay in sOverlays" id="{{overlay.id}}" name="{{overlay.fullType}}"
                                       path="{{overlay.geom.path}}" bounds="{{overlay.geom.bounds}}" center="{{overlay.geom.center}}"
                                       radius="{{overlay.geom.radius}}" fill-color="{{overlay.color}}" on-click="clickOverlay($event)"
                                       stroke-color="dark{{overlay.color}}" stroke-width="1"></shape>

                                <!-- INFO WINDOW -->
                                <info-window id="iw" position="{{selectedOverlay.centroid}}">
                                    <div ng-non-bindable>
                                        <strong>{{selectedOverlay.name}}</strong>
                                        <p>{{selectedOverlay.description}}</p>
                                    </div>
                                </info-window>

                                <info-window id="iw2" position="{{newOverlay.centroid}}">
                                    <div ng-non-bindable>
                                        <input class="form-control" type="text" ng-model="newOverlay.name" placeholder="Nombre">
                                        <textarea class="form-control" ng-model="newOverlay.description" placeholder="Descripción"></textarea>
                                        <button class="btn btn-primary btn-sm" ng-click="sendOverlay()">{{'send' | lang}}</button>
                                        <button class="btn btn-danger btn-sm" ng-click="closeOverlay()">{{'cancel' | lang}}</button>
                                    </div>
                                </info-window>

                            </ng-map>
                        </div>
                    </div>
                    <hr>
                    <br>
                </div>

                <button class="btn btn-default form-control" ng-click="startNewQuestion()" ng-hide="newQsExp"><i class="fa fa-plus"></i> {{'add' | lang}} {{'question' | lang}}</button>

                <div ng-show="newQsExp">
                    <label ng-show="newQuestion.id == null">{{'add' | lang}} {{'question' | lang}}:</label>
                    <label ng-show="newQuestion.id != null">{{'edit' | lang}} {{'question' | lang}} {{newQuestion.order}}:</label>
                    <span class="text-muted">({{'dontIncludeNumbering' | lang}})</span>
                    <ng-quill-editor ng-model="newQuestion.content" ng-class="{'quill-disabled': selectedSes.status!=1}" on-editor-created="configQuillExtra(editor)"></ng-quill-editor>
                    <!--<textarea rows="2" class="form-control" ng-model="newQuestion.content" ng-disabled="selectedSes.status!=1"></textarea>-->

                    <!-- MAP -->
                    <button class="btn btn-default btn-sm" ng-click="toggleMapPlugin()" ng-class="{active: newQuestion.includesMap}" ng-disabled="selectedSes.status!=1">
                        <i class="fa fa-map"></i> {{'mapPlugin' | lang}}
                    </button>
                    <div ng-show="newQuestion.includesMap">
                        <h4>{{'studentOptions' | lang}}</h4>
                        <label><input type="checkbox" ng-model="misc.mapNav"> {{'allow' | lang}} {{'navigation' | lang}}</label>
                        <br>
                        <label><input type="checkbox" ng-model="misc.mapEdit"> {{'allow' | lang}} {{'editting' | lang}}</label>
                    </div>
                    <br>
                    <!-- /MAP -->

                    <label>{{'options' | lang}}:</label>
                    <div class="input-group" ng-repeat=" x in qsLabels">
                        <a class="input-group-addon" ng-bind="x" ng-click="selectAnswer($index)"
                           ng-class="{'bg-green': $index == newQuestion.answer}" ng-disabled="selectedSes.status!=1"></a>
                        <input type="text" class="form-control" ng-model="newQuestion.alternatives[$index]" ng-disabled="selectedSes.status!=1">
                    </div>
                    <label>{{'text' | lang}}</label>
                    <select ng-model="newQuestion.textid" ng-disabled="selectedSes.status!=1" ng-options="text.id as text.title for text in questionTexts" class="form-control"></select>
                    <label>{{'comment' | lang}} ({{'solution' | lang}}):</label>
                    <textarea rows="2" class="form-control" ng-model="newQuestion.comment" ng-disabled="selectedSes.status!=1"></textarea>
                    <label>{{'others' | lang}}:</label>
                    <input type="text" class="form-control" ng-model="newQuestion.other" ng-disabled="selectedSes.status!=1">
                    <button class="btn btn-default pull-right" ng-click="addQuestion()" ng-show="newQuestion.id == null" ng-disabled="selectedSes.status!=1">{{'add' | lang}}</button>
                    <button class="btn btn-default pull-right" ng-click="updateQuestion()" ng-show="newQuestion.id != null" ng-disabled="selectedSes.status!=1">{{'update' | lang}}</button>
                </div>

                <br>
                <br>

            </div>
        </div>
            <!--<br>
            <hr>
            <br>
            <h4>{{'configuration' | lang}}</h4>
            </div>--
            <a class="pull-right btn btn-default" ng-click="setTabConfig(-1)"><i class="fa fa-close"></i></a>
            <div class="row">
            <div class="btn-group center-block w500">
                <button class="btn btn-default" ng-repeat="x in tabConfig" ng-bind="x" ng-show="x != null"
                        ng-class="{active: $index==selectedTabConfig}" ng-click="setTabConfig($index)">
                </button>
            </div>
            </div>-->

            <!-- USUARIOS -->
            <div class="pad-content" ng-show="selectedTab == 'users'" ng-controller="NewUsersController">
                <h4>{{'invitationCode' | lang}}</h4>
                <div ng-show="selectedSes.code == null">
                    <strong>{{'invitationCodeNotActived' | lang}}</strong>
                    <br>
                    <button class="btn btn-primary" ng-click="generateCode()">{{'generateCode' | lang}}</button>
                </div>
                <div ng-show="selectedSes.code != null">
                    <span class="invitation-code">{{selectedSes.code}}</span>
                </div>
                <br>
                <hr>
                <br>
                <h4>{{'users' | lang}}</h4>
                <label>{{'bySpecificUsers' | lang}}</label>
                <div class="row">
                    <div class="col-xs-6">
                        <multiselect ms-header="Seleccionar Usuarios" multiple="true" options="x.name for x in newUsers"
                                     ng-model="newMembs" show-search="true" ng-disabled="selectedSes.status > 2">
                        </multiselect>
                    </div>
                    <div class="col-xs-3">
                        <button class="btn btn-default form-control" ng-click="newMembs = newUsers" ng-disabled="selectedSes.status > 2">
                            <i class="fa fa-check-square-o"></i> {{'selectAll' | lang}}</button>
                    </div>
                    <div class="col-xs-3">
                        <button class="btn btn-default form-control" ng-click="addToSession()" ng-disabled="selectedSes.status > 2">
                            <i class="fa fa-plus"></i> {{'addToSession' | lang}}</button>
                    </div>
                </div>
                <br>
                <hr>
                <br>
                <button class="btn btn-default pull-right" ng-click="refreshUsers()">{{'update' | lang}}</button>
                <h4>{{'users' | lang}}</h4>
                <table class="table table-bordered">
                    <tr><th>{{'user' | lang}}</th><th>Email</th><th>{{'knowledgeType' | lang}}</th><th></th></tr>
                    <tr ng-repeat="alum in usersArr" ng-class="{'bg-info': alum.role == 'P'}">
                        <td ng-bind="alum.name"></td>
                        <td ng-bind="alum.mail"></td>
                        <td ng-bind="alum.aprendizaje"></td>
                        <td><button class="btn btn-default btn-sm" ng-click="removeUser(alum.id)" ng-disabled="selectedSes.status > 2"><i class="fa fa-trash"></i></button></td>
                    </tr>
                </table>
                <br/>
                <hr/>
                <br>
                <label>{{'uploadStudentList' | lang}}</label>
                <div class="input-group">
                    <input type="file" class="form-control" disabled>
                    <span class="input-group-btn">
                    <button class="btn btn-default" disabled>{{'add' | lang}}</button>
                </span>
                </div>
            </div>
            <!-- / USUARIOS -->

            <!-- GRUPOS -->
            <div class="pad-content" ng-show="selectedTab == 'groups'" ng-controller="GroupController">
                <h4>{{'groups' | lang}}</h4>
                <!--<p>Las propuestas de grupo intentan agrupar alumnos con distintos tipos de puntaje</p>-->
                <br>
                <label>{{'studentsPerGroup' | lang}}: </label>
                <input class="form-control form-inline-mini" ng-model="groupNum" type="number" min="2" ng-disabled="selectedSes.grouped">
                <select class="form-control form-inline-med" ng-options="x.key as x.name for x in methods" ng-disabled="selectedSes.grouped" ng-model="groupMet"></select>
                <button class="btn btn-default" ng-click="generateGroups()" ng-disabled="selectedSes.grouped">Generar</button>
                <span ng-show="selectedSes.grouped"> - {{'groupsAreSet' | lang}}</span>
                <button class="btn btn-default pull-right" ng-click="acceptGroups()" ng-disabled="selectedSes.grouped">{{'setGroups' | lang}}</button>
                <br>
                <hr>
                <br>
                <h4><span ng-show="!self.selectedSes.grouped">{{'proposeOf' | lang}} </span>{{'groups' | lang}}:</h4>
                <table class="table table-bordered">
                    <tr ng-repeat="group in groups">
                        <td ng-bind="$index + 1"></td>
                        <td ng-repeat="alum in group">
                            <strong ng-bind="users[alum.uid || alum.id].name"></strong>
                            <span class="label label-success" ng-show="alum.score!=null">
                                {{(selectedSes.type == "L" || selectedSes.type == "M") ? alum.score * 100 : alum.score | number:0}}
                            </span>
                            <span class="label label-info" ng-bind="alum.aprendizaje"></span>
                        </td>
                    </tr>
                </table>
                <hr>
                <!--<h4 ng-if="!selectedSes.grouped" ng-show="false">Editor de Propuesta de Grupos:</h4>
                <table class="table table-bordered table-hover" ng-if="!selectedSes.grouped">
                    <tr ng-repeat="group in groupsProp">
                        <td ng-bind="$index + 1"></td>
                        <td ng-repeat="alum in group" class="pointable" ng-click="swapTable($parent.$index,$index)"
                            ng-class="{'bg-lightgreen': $parent.$index == lastI && $index == lastJ}">
                            <strong ng-bind="users[alum.uid].name"></strong>
                            <span class="label label-success">
                                {{(alum.score!=null)? ((selectedSes.type == "L") ? alum.score * 100 : alum.score) : null | number:0}}
                            </span>
                            <span class="label label-info" ng-bind="alum.aprendizaje"></span>
                        </td>
                    </tr>
                </table>-->
            </div>
            <!-- / GRUPOS -->

            <!-- RUBRICA -->
            <div class="pad-content" ng-show="selectedTab == 'rubrica'" ng-controller="RubricaController">
                <h4>{{'rubricaSpec' | lang}}</h4>
                <!--<h5>Definir esquema de rúbrica:</h5>-->
                <table class="table table-bordered">
                    <tr>
                        <th>{{'criteria' | lang}}</th>
                        <th>% {{'pond' | lang}}</th>
                        <th>{{'notAccomplished' | lang}} (1p)</th>
                        <th>{{'inProcess' | lang}} (2p)</th>
                        <th>{{'toAccomplish' | lang}} (3p)</th>
                        <th>{{'accomplished' | lang}} (4p)</th>
                        <th ng-if="editable"></th>
                    </tr>
                    <tr ng-repeat="criterio in criterios" ng-if="!editable">
                        <td ng-bind="criterio.name"></td>
                        <td ng-bind="criterio.pond"></td>
                        <td ng-bind="criterio.inicio"></td>
                        <td ng-bind="criterio.proceso"></td>
                        <td ng-bind="criterio.competente"></td>
                        <td ng-bind="criterio.avanzado"></td>
                    </tr>
                    <tr ng-repeat="criterio in criterios" ng-if="editable">
                        <td><input ng-model="criterio.name" class="w150"></td>
                        <td><input ng-model="criterio.pond" class="w50" type="number"></td>
                        <td><input ng-model="criterio.inicio" class="w150"></td>
                        <td><input ng-model="criterio.proceso" class="w150"></td>
                        <td><input ng-model="criterio.competente" class="w150"></td>
                        <td><input ng-model="criterio.avanzado" class="w150"></td>
                        <td><button class="btn btn-default btn-sm" ng-if="editable" ng-click="removeCriterio($index)"><i class="fa fa-times"></i></button></td>
                    </tr>
                </table>
                <div class="row">
                    <div class="col-sm-3 col-sm-offset-6">
                        <span ng-show="!checkSum()" class="red">{{'sumOfCritnot100p' | lang}}</span>
                    </div>
                    <div class="col-sm-3">
                        <button class="btn btn-default" ng-if="editable" ng-click="addCriterio()" ng-disabled="checkSum()"><i class="fa fa-plus"></i> {{'add' | lang}}</button>
                        <button class="btn btn-default" ng-disabled="!checkSum() || !editable" ng-click="saveRubrica()">{{'save' | lang}}</button>
                        <button class="btn btn-default" ng-if="!editable && selectedSes.status == 1" ng-click="startEditing()">{{'edit' | lang}}</button>
                    </div>
                </div>
                <br><br>
                <hr>
                <div ng-show="selectedSes.type == 'L'">
                <h4>{{'exampleReport' | lang}}</h4>
                <ul class="list-group">
                    <li class="list-group-item" ng-repeat="text in exampleReports">
                        <div class="row">
                            <div class="col-sm-11 text-justify">
                                <strong ng-bind="text.title"></strong><br>
                                <span ng-bind="text.content | limitTo:500"></span>
                                <span ng-show="text.content.length > 500">...</span>
                            </div>
                            <div class="col-sm-1">
                                <button class="btn btn-default" ng-click="goToReport(text)"><i class="fa fa-edit"></i></button>
                                <button class="btn btn-default" ng-click="setActiveExampleReport(text)" ng-class="{'btn-success':text.active}">
                                    <i class="fa fa-share"></i></button>
                            </div>
                        </div>
                    </li>
                </ul>
                <h5>{{'add' | lang}} {{'exampleReport' | lang}}:</h5>
                <input class="form-control" ng-model="newExampleReport.title" placeholder="Titulo" maxlength="20">
                <textarea rows="5" class="form-control" ng-model="newExampleReport.text" placeholder="Contenido"></textarea>
                <button class="btn btn-default pull-right" ng-disabled="newExampleReport.text.length==0" ng-click="sendExampleReport()">{{'save' | lang}}</button>
                <br><br>
                <hr>
                </div>
                <div ng-show="selectedSes.status >= 5">
                <h4>{{'pairEval' | lang}}</h4>
                <span ng-show="selectedSes.paired > 0">{{'pairAlreadyAssigned' | lang}}</span>
                <div ng-hide="selectedSes.paired > 0">
                    <strong>{{'numOfPairs' | lang}}:</strong>
                    <input type="number" class="form-control form-inline-mini" min="2" max="8" step="1" ng-model="pairNum">
                    <button class="btn btn-default" ng-click="pairAssign()">{{'assignPairs' | lang}}</button>
                </div>
                <span class="red" ng-bind="errPairMsg"></span>
                </div>
            </div>
            <!-- / RUBRICA -->

            <!-- OPTIONS --
            <div class="pad-content" ng-show="selectedTabConfig == 'options' && updateConf()" ng-controller="OptionsController">

            </div>
            <!-- /OPTIONS -->

        <!-- / CONFIGURACION -->

        <!-- DASHBOARDS -->
        <div class="pad-content" ng-show="selectedTab == 'dashboard'" ng-controller="DashboardController">
            <div class="pull-right">
                <label>{{'iteration' | lang}}:</label>
                <select class="" ng-options="x.val as flang(x.name) for x in iterationNames" ng-model="iterationIndicator" ng-change="updateState()"></select>
                <button class="btn btn-default" ng-click="updateState()">{{'update' | lang}}</button>
            </div>
            <h4></h4><br>

            <nvd3 options="barOpts" data="barData" ng-hide="iterationIndicator == 0 || iterationIndicator == 4"></nvd3>

            <div class="row" ng-show="iterationIndicator < 5 && (selectedSes.type == 'L' || selectedSes.type == 'M')">
                <div class="col-sm-4 col-sm-offset-2">
                    {{'finished' | lang}}: <strong>{{numComplete}} / {{numUsers}}</strong>
                </div>
                <div class="col-sm-6" ng-hide="iterationIndicator == 0 || iterationIndicator == 4">
                    {{'performance' | lang}}: <strong>{{lectPerformance() | number:0 }}%</strong>
                </div>
            </div>
            <div class="row" ng-show="selectedSes.type == 'S'">
                <div class="col-sm-3 col-sm-offset-1">
                    {{'progress' | lang}}: <strong>{{progress() | number:0}}%</strong>
                </div>
                <div class="col-sm-4">
                    {{'corrects' | lang}}: <strong>{{avgAll() | number:0 }}%</strong>
                </div>
                <div class="col-sm-4">
                    {{'incorrects' | lang}}: <strong>{{100 - avgAll() | number:0 }}%</strong>
                </div>
            </div>
            <hr>
            <button class="btn btn-default btn-sm pull-right" ng-click="showCf = !showCf" ng-show="selectedSes.type == 'S'">{{'show' | lang}} {{'confidenceLevel' | lang}}</button>
            <table class="table table-bordered" ng-show="showCf">
                <tr>
                    <th>{{'confidenceLevel' | lang}}</th>
                    <th>{{'Pr' | lang}}.</th>
                    <th ng-repeat="qs in questions" ng-bind="$index + 1"></th>
                    <th>{{'Av' | lang}}.</th>
                </tr>
                <tr ng-repeat="conf in optConfidence">
                    <td>{{conf}}%</td>
                    <td></td>
                    <td ng-repeat="qs in questions" ng-bind="confidence[qs.id][conf] || 0"></td>
                    <td></td>
                </tr>
            </table>

            <br>
            <table class="table table-bordered" ng-if="selectedSes.type == 'S'">
                <tr>
                    <th ng-if="iterationIndicator != 3">{{'student' | lang}}</th>
                    <th ng-if="iterationIndicator == 3">{{'group' | lang}}</th>
                    <th>{{'Pr' | lang}}.</th>
                    <th ng-repeat="qs in questions" ng-bind="$index + 1"></th>
                    <th>{{'Av' | lang}}.</th>
                </tr>
                <tr>
                    <td>{{'progress' | lang}}</td>
                    <td>{{progress() | number:0}}%</td>
                    <td ng-repeat="qs in questions">{{progressPreg(qs.id) | number:0}}%</td>
                    <td class="bg-gray"></td>
                </tr>
                <tr ng-repeat="(alum, data) in alumState">
                    <td ng-if="iterationIndicator != 3" ng-bind="users[alum].name"></td>
                    <td ng-if="iterationIndicator == 3" ng-bind="leaderTeamStr[alum]"></td>
                    <td>{{progressAlum(alum) | number:0}}%</td>
                    <td ng-repeat="qs in questions"
                        ng-class="{'bg-darkgreen': data[qs.id], 'bg-darkred': data[qs.id]!=null && !data[qs.id]}"
                        ng-click="showDetailAnswer(qs.id, alum, iterationIndicator)"></td>
                    <td>{{avgAlum(alum) | number:0}}%</td>
                </tr>
                <tr>
                    <td>{{'average' | lang}} {{'corrects' | lang}}</td>
                    <td class="bg-gray"></td>
                    <td ng-repeat="qs in questions">{{avgPreg(qs.id) | number:0}}%</td>
                    <td>{{avgAll() | number:0}}%</td>
                </tr>
            </table>
            <table class="table table-bordered" ng-if="(selectedSes.type == 'L' || selectedSes.type == 'M') && alumState!={} && iterationIndicator <= 4">
                <tr>
                    <th ng-if="iterationIndicator != 3">{{'student' | lang}}</th>
                    <th ng-if="iterationIndicator == 3">{{'group' | lang}}</th>
                    <th style="width: 420px" ng-if="iterationIndicator != 0 && iterationIndicator != 4">{{'score' | lang}}</th>
                    <th>{{'finishTime' | lang}}</th>
                </tr>
                <tr ng-repeat="(alum, dato) in alumState">
                    <td ng-if="iterationIndicator != 3">
                        {{users[alum].name}}
                        <button class="btn btn-default btn-sm pull-right" ng-click="showReportByUid(alum)" ng-show="iterationIndicator==4"><i class="fa fa-eye"></i></button>
                    </td>
                    <td ng-if="iterationIndicator == 3" ng-bind="leaderTeamStr[alum]"></td>
                    <td ng-if="iterationIndicator != 0 && iterationIndicator != 4">
                        <div class="bg-darkgreen table-green-bar" ng-show="dato.score != null" style="width: {{400*dato.score}}px;">
                            {{100*dato.score | number:0}}%
                        </div>
                    </td>
                    <td><span ng-show="dato.dtime != null">{{dato.dtime/60 | number:0}}m {{dato.dtime%60 | number:0}}s</span></td>
                </tr>
            </table>
            <!-- RUBRICA DASHBOARD -->
            <div ng-show="iterationIndicator == 5">
            <h4>{{'details' | lang}}:</h4>
            <div class="row">
                <div class="col-sm-2">{{'report' | lang}}: </div>
                <div class="col-sm-8">
                    <select class="form-control" ng-model="selectedReport" ng-options="showName(x) for x in exampleReports"
                            ng-change="getReportResult()"></select>
                </div>
                <div class="col-sm-2">
                    <button class="btn btn-default" ng-click="getReportResult()">{{'view' | lang}} {{'results' | lang}}</button>
                </div>
            </div>
            <table class="table table-bordered">
                <tr>
                    <th>{{'student' | lang}}</th>
                    <th style="width: 420px">{{'evaluation' | lang}}</th>
                </tr>
                <tr ng-repeat="dato in result | orderBy:'-val'">
                    <td ng-bind="users[dato.uid].name"></td>
                    <td>
                        <div class="bg-darkgreen table-green-bar" style="width: {{100*dato.val}}px;">
                            {{dato.val | number:2}}
                        </div>
                    </td>
                </tr>
            </table>
            </div>
            <div ng-show="iterationIndicator == 6">
                <h4>{{'details' | lang}} {{'report' | lang}}:</h4>
                <table class="table table-bordered">
                    <tr>
                        <th>{{'report' | lang}}</th>
                        <th ng-repeat="x in getInMax(resultAll) track by $index">Ev. {{$index + 1}}</th>
                        <th>{{'average' | lang}}</th>
                    </tr>
                    <!--<tr ng-repeat="dato in result | orderBy:'-score'">-->
                    <tr ng-repeat="(alum,row) in resultAll">
                        <td>
                            {{'reportOf' | lang}} <span ng-bind="users[alum].name"></span>
                            <i class="fa fa-check-square" ng-show="row.reviews == selectedSes.paired"></i>
                            <button class="btn btn-default btn-sm pull-right" ng-click="broadcastReport(row.data[0].rid)" ng-show="selectedSes.status == 9">
                                <i class="fa fa-share"></i>
                            </button>
                            <button class="btn btn-default btn-sm pull-right" ng-click="showReport(row.data[0].rid)"><i class="fa fa-eye"></i></button>
                        </td>
                        <td ng-repeat="x in getInMax(resultAll) track by $index">
                            {{row.data[$index].val | number:2}}
                        </td>
                        <td>{{getAvg(row.data) | number:2}}</td>
                    </tr>
                </table>
            </div>
        </div>
        <!-- / DASHBOARDS -->

        <!-- DASHBOARDS RUBRICA --
        <div class="pad-content" ng-show="selectedTab == 2" ng-controller="DashboardRubricaController">
            <h4>{{'results' | lang}} {{'rubrica' | lang}}</h4>
            <button class="pull-right btn btn-default" ng-click="getAllReportResult()">{{'update' | lang}}</button>
            <nvd3 options="barOpts" data="barData"></nvd3>
            <hr>
        </div>
        <!-- / DASHBOARDS RUBRICA -->

    </div>

</div>

</body>
</html>